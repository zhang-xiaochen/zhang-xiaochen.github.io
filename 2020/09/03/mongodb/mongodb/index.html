

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=&#34;auto&#34;>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/favicon.png">
  <link rel="icon" type="image/png" href="/img/favicon.png">
  <meta name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="description" content="">
  <meta name="author" content="John Doe">
  <meta name="keywords" content="">
  <title>MongoDB(一) - 方寸山</title>

  <link  rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/css/bootstrap.min.css" />


  <link  rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css" />
  <link  rel="stylesheet" href="/lib/hint/hint.min.css" />

  
    
    <link  rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.0.0/styles/tomorrow.min.css" />
  

  


<!-- 主题依赖的图标库，不要自行修改 -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_6peoq002giu.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_pjno9b9zyxs.css">


<link  rel="stylesheet" href="/css/main.css" />

<!-- 自定义样式保持在最底部 -->


  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
<meta name="generator" content="Hexo 5.0.2"></head>


<body>
  <header style="height: 70vh;">
    <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand"
       href="/">&nbsp;<strong>方寸山</strong>&nbsp;</a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                首页
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                归档
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                分类
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                标签
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                关于
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i
                class="iconfont icon-search"></i>&nbsp;</a>
          </li>
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" href="javascript:">&nbsp;<i
                class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

    <div class="banner intro-2" id="background" parallax=true
         style="background: url('/img/default.png') no-repeat center center;
           background-size: cover;">
      <div class="full-bg-img">
        <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
          <div class="container page-header text-center fade-in-up">
            <span class="h2" id="subtitle">
              
            </span>

            
              
  <div class="mt-3 post-meta">
    <i class="iconfont icon-date-fill" aria-hidden="true"></i>
    <time datetime="2020-09-03 17:40" pubdate>
      2020年9月3日 下午
    </time>
  </div>


<div class="mt-1">
  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-chart"></i>
      5k 字
    </span>
  

  
    
    <span class="post-meta mr-2">
      <i class="iconfont icon-clock-fill"></i>
      
      
      80
       分钟
    </span>
  

  
  
</div>

            
          </div>

          
        </div>
      </div>
    </div>
  </header>

  <main>
    
      

<div class="container-fluid">
  <div class="row">
    <div class="d-none d-lg-block col-lg-2"></div>
    <div class="col-lg-8 nopadding-md">
      <div class="container nopadding-md" id="board-ctn">
        <div class="py-5" id="board">
          <article class="post-content mx-auto" id="post">
            <!-- SEO header -->
            <h1 style="display: none">MongoDB(一)</h1>
            
            <div class="markdown-body" id="post-body">
              <h1 id="MongoDB-一"><a href="#MongoDB-一" class="headerlink" title="MongoDB (一)"></a>MongoDB (一)</h1><blockquote>
<p>MongoDB（来自于英文单词“Humongous”，中文含义为“庞大”）是可以应用于各种规模的企业、各个行业以及各类应用程序的开源数据库。作为一个适用于敏捷开发的数据库，MongoDB的数据模式可以随着应用程序的发展而灵活地更新。与此同时，它也为开发人员 提供了传统数据库的功能：<code>二级索引</code>，<code>完整的查询系统</code>以及<code>严格一致性</code>等等。 MongoDB能够使企业更加具有<code>敏捷性</code>和<code>可扩展性</code>，各种规模的企业都可以通过使用MongoDB来创建新的应用，提高与客户之间的工作效率，加快产品上市时间，以及降低企业成本。</p>
<p>MongoDB是专为<code>可扩展性</code>，<code>高性能</code>和<code>高可用性</code>而设计的数据库。它可以从<code>单服务器</code>部署扩展到大型、复杂的<code>多数据中心</code>架构。利用<code>内存计算</code>的优势，MongoDB能够提供<code>高性能的数据读写操作</code>。 MongoDB的<code>本地复制</code>和<code>自动故障转移</code>功能使您的应用程序具有企业级的<code>可靠性</code>和<code>操作灵活性</code>。</p>
</blockquote>
<h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>MongoDB有两个版本，社区版和企业版。（以下使用ubuntu社区版）</p>
<blockquote>
<p>version 4.4</p>
</blockquote>
<h3 id="社区版"><a href="#社区版" class="headerlink" title="社区版"></a>社区版</h3><blockquote>
<p>不支持WSL</p>
</blockquote>
<ol>
<li><p>包管理添加公钥</p>
 <pre><code class="hljs shell">~ ❯ wget -qO - https://www.mongodb.org/static/pgp/server-4.4.asc | sudo apt-key add -   06:31:54 PM
OK</code></pre>

<p> 如果执行失败，提示gnupg未安装，则先执行安装gnupg命令，然后重试。</p>
 <pre><code class="hljs shell">sudo apt-get install gnupg</code></pre>
</li>
<li><p>生成列表文件</p>
<ul>
<li>ubuntu 18.04</li>
</ul>
<pre><code class="hljs shell">echo &quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu bionic/mongodb-org/4.4 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list</code></pre>

<ul>
<li>ubuntu 20.04</li>
</ul>
<pre><code class="hljs shell">echo &quot;deb [ arch=amd64,arm64 ] https://repo.mongodb.org/apt/ubuntu focal/mongodb-org/4.4 multiverse&quot; | sudo tee /etc/apt/sources.list.d/mongodb-org-4.4.list</code></pre>
</li>
<li><p>更新</p>
 <pre><code class="hljs shell">sudo apt-get update</code></pre>
</li>
<li><p>下载</p>
<ul>
<li>最新版本</li>
</ul>
<pre><code class="hljs shell">sudo apt-get install -y mongodb-org</code></pre>

<ul>
<li>指定版本</li>
</ul>
<pre><code class="hljs shell">sudo apt-get install -y mongodb-org=4.4.0 mongodb-org-server=4.4.0 mongodb-org-shell=4.4.0 mongodb-org-mongos=4.4.0 mongodb-org-tools=4.4.0</code></pre>

<blockquote>
<p>将MongoDB固定到当前版本，避免升级包时候误升级。</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;mongodb-org hold&quot;</span> | sudo dpkg --<span class="hljs-built_in">set</span>-selections</span>
<span class="hljs-meta">&gt;</span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;mongodb-org-server hold&quot;</span> | sudo dpkg --<span class="hljs-built_in">set</span>-selections</span>
<span class="hljs-meta">&gt;</span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;mongodb-org-shell hold&quot;</span> | sudo dpkg --<span class="hljs-built_in">set</span>-selections</span>
<span class="hljs-meta">&gt;</span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;mongodb-org-mongos hold&quot;</span> | sudo dpkg --<span class="hljs-built_in">set</span>-selections</span>
<span class="hljs-meta">&gt;</span><span class="bash"><span class="hljs-built_in">echo</span> <span class="hljs-string">&quot;mongodb-org-tools hold&quot;</span> | sudo dpkg --<span class="hljs-built_in">set</span>-selections</span></code></pre>
</blockquote>
</li>
</ol>
<p>其他版本安装参考：<a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/installation/">官方文档</a></p>
<h2 id="MongoShell"><a href="#MongoShell" class="headerlink" title="MongoShell"></a>MongoShell</h2><blockquote>
<p>MongoShell是由JavaScript实现的MongoDB客户端命令行工具，可以用来增删改查，执行权限操作等。</p>
<p>MongoDB 4.2 (and 4.0.13)之后连接非官方MongoDB，会有提示警告信息。</p>
<p>限制每行4095 个codepoints ，超过会被截断。</p>
</blockquote>
<ol>
<li><p>本地连接</p>
<p> 直接用mongo命令连接，默认端口<code>27017</code></p>
 <pre><code class="hljs shell">mongo</code></pre>

<p> 指定端口</p>
 <pre><code class="hljs shell">mongo --port 28028</code></pre>
</li>
<li><p>远程连接</p>
<ul>
<li><p>需要明确指定主机名和端口号</p>
</li>
<li><p>字符串</p>
<pre><code class="hljs shell">mongo &quot;mongodb://mongodb0.example.com:28015&quot;</code></pre>
</li>
<li><p>mongo –host <host>:<port></p>
<pre><code class="hljs shell">mongo --host mongodb0.example.com:28015</code></pre>
</li>
<li><p>mongo –host <host> –port <port></p>
<pre><code class="hljs apache"><span class="hljs-attribute">mongo</span> --host mongodb<span class="hljs-number">0</span>.example.com --port <span class="hljs-number">28015</span></code></pre>
</li>
</ul>
</li>
<li><p>需要身份验证的实例</p>
<ul>
<li><p>字符串</p>
<pre><code class="hljs shell">mongo &quot;mongodb://alice@mongodb0.examples.com:28015/?authSource=admin&quot;</code></pre>

<blockquote>
<p>可以不指定密码，shell会提示输入密码。</p>
</blockquote>
</li>
<li><p>–username <username> –password –authenticationDatabase <db></p>
<pre><code class="hljs shell">mongo --username alice --password --authenticationDatabase admin --host mongodb0.examples.com --port 28015</code></pre>

<blockquote>
<p>指定–password参数，而没有输入密码，shell同样会提示输入密码。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>连接集群</p>
<ul>
<li><p>字符串(一组连接字符串’,’分割)</p>
<pre><code class="hljs shell">mongo &quot;mongodb://mongodb0.example.com.local:27017,mongodb1.example.com.local:27017,mongodb2.example.com.local:27017/?replicaSet=replA&quot;</code></pre>
</li>
<li><p>命令 –host <set name>/<host>:<port>,<host>:<port></p>
<pre><code class="hljs shell">mongo --host replA/mongodb0.example.com.local:27017,mongodb1.example.com.local:27017,mongodb2.example.com.local:27017</code></pre>
</li>
</ul>
</li>
<li><p>TLS/SSL连接</p>
<ul>
<li><p>字符串指定<code>ssl=true</code>参数</p>
<pre><code class="hljs shell">mongo &quot;mongodb://mongodb0.example.com.local:27017,mongodb1.example.com.local:27017,mongodb2.example.com.local:27017/?replicaSet=replA&amp;ssl=true&quot;</code></pre>
</li>
<li><p>DNS种子列表连接</p>
<pre><code class="hljs shell">mongo &quot;mongodb+srv://server.example.com/&quot;</code></pre>

<blockquote>
<p>使用+ srv连接字符串修饰符会自动将ssl选项设置为true。</p>
</blockquote>
</li>
<li><p>命令行 指定 –ssl参数</p>
<pre><code class="hljs shell">mongo --ssl --host replA/mongodb0.example.com.local:27017,mongodb1.example.com.local:27017,mongodb2.example.com.local:27017</code></pre>

<p>mongo shell 使用：</p>
</li>
<li><p>显示当前使用的库</p>
<pre><code class="hljs shell">db</code></pre>
</li>
<li><p>列出所有库</p>
<pre><code class="hljs shell">show dbs</code></pre>
</li>
<li><p>切换库</p>
<pre><code class="hljs shell">use &lt;database&gt;</code></pre>

<blockquote>
<p><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/db.getSiblingDB/#db.getSiblingDB"><code>db.getSiblingDB()</code></a>从当前数据库访问其他数据库而不切换当前db</p>
<p>可以直接切到不存在的库，新插入数据时候会自动新建库及集合；只切新库，不执行插入操作是不会新建库及集合的。</p>
<pre><code class="hljs shell">use myNewDatabase
db.myCollection.insertOne( &#123; x: 1 &#125; );</code></pre>

<ul>
<li>db 当前数据库 </li>
<li>myCollection 集合名</li>
<li>insertOne() 插入记录方法</li>
</ul>
<p>如果集合名含有空格、-、数字开头或者是与内置函数冲突，则不能用db.<collection name>的方式选中集合，使用db.getCollection()代替。（db.getCollection(‘my-Collection’)）</p>
</blockquote>
</li>
<li><p>列出当前库集合</p>
<pre><code class="hljs shell">show collections</code></pre>

<p>输出结果格式化：</p>
<pre><code class="hljs shell">db.myCollection.find().pretty()</code></pre>

<p>其他格式化方法：</p>
<p>print() ,printjson() , print(tojson(<obj>))</p>
<p>qiut(); ctrl c 退出mongo shell</p>
<p>其他操作文档连接：</p>
</li>
</ul>
<ul>
<li><a target="_blank" rel="noopener" href="https://docs.mongodb.com/getting-started/shell">Getting Started Guide</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/insert-documents/">Insert Documents</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/query-documents/">Query Documents</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/update-documents/">Update Documents</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/tutorial/remove-documents/">Delete Documents</a></li>
<li><a target="_blank" rel="noopener" href="https://docs.mongodb.com/manual/reference/method/">mongo Shell Methods</a></li>
</ul>
</li>
</ol>
<h3 id="样式配置"><a href="#样式配置" class="headerlink" title="样式配置"></a>样式配置</h3><ol>
<li><p>自定义提示</p>
<p>对prompt进行设置，可以是字符串或者是JavaScript代码。可以在当前mongo shell中设置 也可以在<code>/etc/mongorc.js</code>文件中进行设置。</p>
<ul>
<li><p>显示行号<br><img src="/img/mongodb/image-20200915181642262.png" srcset="/img/loading.gif" alt="image-20200915181642262"></p>
</li>
<li><p>显示db和hostname<br><img src="/img/mongodb/image-20200915181715722.png" srcset="/img/loading.gif" alt="image-20200915181715722"></p>
</li>
<li><p>显示系统正常运行时间和当前文档数量<br><img src="/img/mongodb/image-20200915181738149.png" srcset="/img/loading.gif" alt="image-20200915181738149"></p>
</li>
</ul>
</li>
</ol>
<ol start="2">
<li><p>使用外部编辑器</p>
<p> 启动mongo shell之前设置<code>EDITOR</code>环境变量</p>
 <pre><code class="hljs shell">export EDITOR=vim
mongo</code></pre>

<p> 在mongo shell中用 edit &lt;function&gt; ,edit&lt;variable&gt;来打开外部编辑器进行编辑。</p>
</li>
<li><p>设置Batch Size （default number of items to display on shell）</p>
 <pre><code class="hljs shell">DBQuery.shellBatchSize = 10;</code></pre>


</li>
</ol>
<h3 id="查看帮助"><a href="#查看帮助" class="headerlink" title="查看帮助"></a>查看帮助</h3><ol>
<li><p>mongo 参数帮助</p>
 <pre><code class="hljs shell">mongo --shell</code></pre>
</li>
<li><p>mongo shell中细分的其他帮助</p>
 <pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> <span class="hljs-built_in">help</span></span>
     db.help()                    help on db methods # db相关的方法帮助文档
     db.mycoll.help()             help on collection methods # 集合~
     sh.help()                    sharding helpers # 分片~
     rs.help()                    replica set helpers # 复制~
     help admin                   administrative help # 管理~
     help connect                 connecting to a db help # 连接~
     help keys                    key shortcuts # 快捷键~
     help misc                    misc things to know # 内置封装类
     help mr                      mapreduce

     show dbs                     show database names
     show collections             show collections in current database
     show users                   show users in current database
     show profile                 show most recent system.profile entries with time &gt;= 1ms
     show logs                    show the accessible logger names
     show log [name]              prints out the last segment of log in memory, &#x27;global&#x27; is default
     use &lt;db_name&gt;                set current database
     db.foo.find()                list objects in collection foo
     db.foo.find( &#123; a : 1 &#125; )     list objects in foo where a == 1
     it                           result of the last line evaluated; use to further iterate
     DBQuery.shellBatchSize = x   set default number of items to display on shell
     exit                         quit the mongo shell</code></pre>
</li>
<li><p>游标相关</p>
<p> 执行find()方法的时候可以用不同的游标方法去修改find()的行为，可以用help()查看可以用那些游标方法</p>
<p> <img src="/img/mongodb/image-20200915184347283.png" srcset="/img/loading.gif" alt="image-20200915184347283"></p>
</li>
</ol>
<h3 id="编写脚本"><a href="#编写脚本" class="headerlink" title="编写脚本"></a>编写脚本</h3><p>mongo shell 由JavaScript实现，可以编写JavaScript脚本进行数据处理。</p>
<p>​    创建新连接</p>
<pre><code class="hljs shell">new Mongo()
new Mongo(&lt;host&gt;)
new Mongo(&lt;host:port&gt;)</code></pre>

<p>​    选择DB</p>
<pre><code class="hljs shell">conn = new Mongo();
db = conn.getDB(&quot;myDatabase&quot;);</code></pre>

<blockquote>
<p>可以用connect()方法连接并选择DB</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash">db = connect(<span class="hljs-string">&quot;localhost:27020/myDatabase&quot;</span>);</span></code></pre>
</blockquote>
<p>​    getDB()和connect()方法会将db设置未全局变量。</p>
<p>常用命令和javascript写法转换：</p>
<table>
<thead>
<tr>
<th align="left">Shell Helpers</th>
<th align="left">JavaScript Equivalents</th>
</tr>
</thead>
<tbody><tr>
<td align="left"><code>show dbs</code>, <code>show databases</code></td>
<td align="left">copycopied<code>db.adminCommand(&#39;listDatabases&#39;) </code></td>
</tr>
<tr>
<td align="left"><code>use &lt;db&gt; </code></td>
<td align="left">copycopied<code>db = db.getSiblingDB(&#39;&lt;db&gt;&#39;) </code></td>
</tr>
<tr>
<td align="left"><code>show collections </code></td>
<td align="left">copycopied<code>db.getCollectionNames() </code></td>
</tr>
<tr>
<td align="left"><code>show users </code></td>
<td align="left">copycopied<code>db.getUsers() </code></td>
</tr>
<tr>
<td align="left"><code>show roles </code></td>
<td align="left">copycopied<code>db.getRoles(&#123;showBuiltinRoles: true&#125;) </code></td>
</tr>
<tr>
<td align="left"><code>show log &lt;logname&gt; </code></td>
<td align="left">copycopied<code>db.adminCommand(&#123; &#39;getLog&#39; : &#39;&lt;logname&gt;&#39; &#125;) </code></td>
</tr>
<tr>
<td align="left"><code>show logs </code></td>
<td align="left">copycopied<code>db.adminCommand(&#123; &#39;getLog&#39; : &#39;*&#39; &#125;) </code></td>
</tr>
<tr>
<td align="left"><code>it </code></td>
<td align="left">copycopied<code>cursor = db.collection.find() if ( cursor.hasNext() )&#123;   cursor.next(); &#125;</code></td>
</tr>
</tbody></table>
<p>–evel 可以向mongo传入JavaScript片段</p>
<pre><code class="hljs shell">mongo test --eval &quot;printjson(db.getCollectionNames())&quot;</code></pre>

<p>引入JavaScript脚本</p>
<pre><code class="hljs shell">mongo localhost:27017/test myjsfile.js</code></pre>

<p>以上两种是在mongo shell外引入JavaScript 如果是在mongo shell中引入使用lload()方法</p>
<pre><code class="hljs shell">load(&quot;myjstest.js&quot;)</code></pre>

<p>load()中指定js脚本可以是相对路径，也可以是绝对路径</p>
<pre><code class="hljs shell">load(&quot;scripts/myjstest.js&quot;)
load(&quot;/data/db/scripts/myjstest.js&quot;)</code></pre>

<blockquote>
<p>相对路径是指相对于当前工作路径而言的；</p>
</blockquote>
<h3 id="数据类型"><a href="#数据类型" class="headerlink" title="数据类型"></a>数据类型</h3><ol>
<li><p>数据类型</p>
<p>Date</p>
<blockquote>
<p>带符号的64位整数，表示1970-1-1以来的毫秒数，并不是所有的操作和驱动支持完全的64位建议年份在0~9999之间</p>
</blockquote>
<ul>
<li><p>Date()返回当前时间的字符串；</p>
</li>
<li><p>new Date() 返回ISODate()；</p>
</li>
<li><p>ISODate 返回 ISODate()；</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> Date()</span>
Fri Sep 11 2020 09:34:15 GMT+0800
<span class="hljs-meta">&gt;</span><span class="bash"> ISODate()</span>
ISODate(&quot;2020-09-11T01:35:21.324Z&quot;)
<span class="hljs-meta">&gt;</span><span class="bash"> var date = new Date();</span>
ISODate(&quot;2020-09-11T01:35:34.051Z&quot;)</code></pre>

</li>
</ul>
<p>ObjectId </p>
<blockquote>
<p>4字节时间戳+5字节随机数+3字节递增计数器</p>
</blockquote>
 <pre><code class="hljs shell">new ObjectId</code></pre>

 <pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> var objId = new ObjectId</span>
<span class="hljs-meta">&gt;</span><span class="bash"> objId</span>
ObjectId(&quot;5f5ade697825049c62468fa8&quot;)</code></pre>

<p>NumberLong</p>
<blockquote>
<p> 默认情况下，mongo shell认为所有的数字为浮点数</p>
</blockquote>
<p> NumberLong() 构造器接收字符串参数</p>
 <pre><code class="hljs shell">NumberLong(&quot;2090845886852&quot;)</code></pre>

<p> eg.</p>
<p><img src="/img/mongodb/image-20200915184948876.png" srcset="/img/loading.gif" alt="image-20200915184948876"></p>
<blockquote>
<p> $inc 用浮点数对’calc’进行递增会使其类型变为浮点数</p>
<p><img src="/img/mongodb/image-20200915185051155.png" srcset="/img/loading.gif" alt="image-20200915185051155"></p>
</blockquote>
<p> NumberInt</p>
<blockquote>
<p>默认情况下，mongo shell 认为所有的数字为浮点数， NumberInt用来显示构造32位整数</p>
</blockquote>
<p> NumberDecimal</p>
<blockquote>
<p>mongo shell提供了NumberDecimal（）构造函数来显式指定基于<code>128位</code>的，基于十进制的浮点值，该值能够精确地模拟十进制舍入。此功能适用于处理货币数据的应用程序，例如<code>金融</code>，<code>税收</code>和<code>科学计算</code>。</p>
</blockquote>
<p> NumberDecimal() 构造器接收字符串参数</p>
 <pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> NumberDecimal(<span class="hljs-string">&quot;1000.55&quot;</span>)</span>
NumberDecimal(&quot;1000.55&quot;)</code></pre>

<blockquote>
<p>NumberDecimal() 构造器,也接受double类型的浮点数，和java 一样会有精度缺失的问题。并且存在隐式转换将双精度转换为15位精度</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> var number = NumberDecimal(1000.55);</span>
<span class="hljs-meta">&gt;</span><span class="bash"> number</span>
NumberDecimal(&quot;1000.55000000000&quot;)</code></pre>

<p>精度缺失eg.</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> var number = NumberDecimal(9999999.4999999999);</span>
<span class="hljs-meta">&gt;</span><span class="bash"> number</span>
NumberDecimal(&quot;9999999.50000000&quot;)</code></pre>
</blockquote>
</li>
<li><p>比较和排序</p>
<p>浮点数和其他数字类型进行比较取决于他们的实际值。二进制双精度浮点数的十进制表示只是其近似值不一定完全相等，建议使用NumberDecimal();</p>
<p>数据集：</p>
<pre><code class="hljs shell">&#123; &quot;_id&quot; : 1, &quot;val&quot; : NumberDecimal( &quot;9.99&quot; ), &quot;description&quot; : &quot;Decimal&quot; &#125;
&#123; &quot;_id&quot; : 2, &quot;val&quot; : 9.99, &quot;description&quot; : &quot;Double&quot; &#125;
&#123; &quot;_id&quot; : 3, &quot;val&quot; : 10, &quot;description&quot; : &quot;Double&quot; &#125;
&#123; &quot;_id&quot; : 4, &quot;val&quot; : NumberLong(10), &quot;description&quot; : &quot;Long&quot; &#125;
&#123; &quot;_id&quot; : 5, &quot;val&quot; : NumberDecimal( &quot;10.0&quot; ), &quot;description&quot; : &quot;Decimal&quot; &#125;</code></pre>

<p>查询：</p>
<table>
<thead>
<tr>
<th align="left">Query</th>
<th align="left">Results</th>
</tr>
</thead>
<tbody><tr>
<td align="left">{ “val”: 9.99 }</td>
<td align="left">{ “_id”: 2, “val”: 9.99, “description”: “Double” }</td>
</tr>
<tr>
<td align="left">{ “val”: NumberDecimal( “9.99” ) }</td>
<td align="left">{ “_id”: 1, “val”: NumberDecimal( “9.99” ), “description”: “Decimal” }</td>
</tr>
<tr>
<td align="left">{ val: 10 }</td>
<td align="left">{ “_id”: 3, “val”: 10, “description”: “Double” }<br>{ “_id”: 4, “val”: NumberLong(10), “description”: “Long” }<br/>{ “_id”: 5, “val”: NumberDecimal( “10.0” ), “description”: “Decimal” }</td>
</tr>
<tr>
<td align="left">{ val: NumberDecimal( “10” ) }</td>
<td align="left">{ “_id”: 3, “val”: 10, “description”: “Double” }<br/>{ “_id”: 4, “val”: NumberLong(10), “description”: “Long” }<br/>{ “_id”: 5, “val”: NumberDecimal( “10.0” ), “description”: “Decimal” }</td>
</tr>
</tbody></table>
<p>十进制9.99对应的实际二进制值是不不等于9.99的因此只等查询到Double类型的一条数据；</p>
<p>十进制10和二进制下的10实际值是一样的，因此可以查询到Double和其他数字类型。</p>
<blockquote>
<p>可以用$type查询特定的数据类型的值</p>
<pre><code class="hljs shell">db.inventory.find( &#123; price: &#123; $type: &quot;decimal&quot; &#125; &#125; )</code></pre>
</blockquote>
</li>
<li><p>数据类型判断：</p>
<p>instanceof 判断是否为某数据类型 返回true或false</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> number</span>
NumberDecimal(&quot;9999999.50000000&quot;)
<span class="hljs-meta">&gt;</span><span class="bash"> number instanceof NumberDecimal</span>
true
<span class="hljs-meta">&gt;</span><span class="bash"> number instanceof NumberLong</span>
false</code></pre>

<p>typeof 返回具体的数据类型</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> typeof number</span>
object</code></pre>



</li>
</ol>
<h3 id="快速参考"><a href="#快速参考" class="headerlink" title="快速参考"></a>快速参考</h3><ol>
<li><p>历史命令</p>
<blockquote>
<p>shell 中的上下键，选择历史命令。历史命令放在~/.dbshell文件中。</p>
</blockquote>
</li>
<li><p>命令行参数</p>
<ul>
<li><p>–help 查看命令行参数信息<br><img src="/img/mongodb/image-20200915185414200.png" srcset="/img/loading.gif" alt="image-20200915185414200"></p>
<p><img src="/img/mongodb/image-20200915185454123.png" srcset="/img/loading.gif" alt="image-20200915185454123"></p>
</li>
</ul>
</li>
</ol>
<ul>
<li><p>–nodb 启动mongo shell,不连接数据库</p>
<pre><code class="hljs shell"><span class="hljs-meta">$</span><span class="bash"> ./mongo.exe --nodb</span>
MongoDB shell version v4.0.10
<span class="hljs-meta">&gt;</span><span class="bash"> db <span class="hljs-comment"># 没连接db</span></span>
2020-09-15T16:50:43.941+0800 E QUERY    [js] ReferenceError: db is not defined :
@(shell):1:1</code></pre>
</li>
<li><p>–shell 和JavaScript脚本一起使用，执行完脚本继续使用mongo shell</p>
</li>
</ul>
<ol start="3">
<li><p>帮助相关方法命令</p>
<ul>
<li><p>help 查看帮助信息</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> <span class="hljs-built_in">help</span></span>
   db.help()                    help on db methods
   db.mycoll.help()             help on collection methods
   sh.help()                    sharding helpers
   rs.help()                    replica set helpers
   help admin                   administrative help
   help connect                 connecting to a db help
   help keys                    key shortcuts
   help misc                    misc things to know
   help mr                      mapreduce

   show dbs                     show database names
   show collections             show collections in current database
   show users                   show users in current database
   show profile                 show most recent system.profile entries with time &gt;= 1ms
   show logs                    show the accessible logger names
   show log [name]              prints out the last segment of log in memory, &#x27;global&#x27; is default
   use &lt;db_name&gt;                set current database
   db.foo.find()                list objects in collection foo
   db.foo.find( &#123; a : 1 &#125; )     list objects in foo where a == 1
   it                           result of the last line evaluated; use to further iterate
   DBQuery.shellBatchSize = x   set default number of items to display on shell
   exit                         quit the mongo shell</code></pre>
</li>
<li><p>db.help() 查看db相关的方法</p>
<pre><code class="hljs shell"> db.help()
DB methods:
   db.adminCommand(nameOrDocument) - switches to &#x27;admin&#x27; db, and runs command [just calls db.runCommand(...)]
   db.aggregate([pipeline], &#123;options&#125;) - performs a collectionless aggregation on this database; returns a cursor
   db.auth(username, password) # 登录
   db.cloneDatabase(fromhost) - deprecated
   db.commandHelp(name) returns the help for the command # 命令帮助
   db.copyDatabase(fromdb, todb, fromhost) - deprecated
   db.createCollection(name, &#123;size: ..., capped: ..., max: ...&#125;)
   db.createView(name, viewOn, [&#123;$operator: &#123;...&#125;&#125;, ...], &#123;viewOptions&#125;)
   db.createUser(userDocument) # 创建用户
   db.currentOp() displays currently executing operations in the db
   db.dropDatabase() # 删除数据库
   ...</code></pre>
</li>
<li><p>db.&lt;collectionName&gt;.help() 集合相关的方法帮助 可以是存在的集合也可以是不存在的集合</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> show collections</span>
files
files.chunks
files.files</code></pre>

<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> db.files.help()</span>
DBCollection help
   db.files.find().help() - show DBCursor help
   db.files.bulkWrite( operations, &lt;optional params&gt; ) - bulk execute write operations, optional parameters are: w, wtimeout, j
   db.files.count( query = &#123;&#125;, &lt;optional params&gt; ) - count the number of documents that matches the query, optional parameters are: limit, skip, hint, maxTimeMS
   db.files.countDocuments( query = &#123;&#125;, &lt;optional params&gt; ) - count the number of documents that matches the query, optional parameters are: limit, skip, hint, maxTimeMS
   ...</code></pre>

<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> db.f.help()</span>
DBCollection help
   db.f.find().help() - show DBCursor help
   db.f.bulkWrite( operations, &lt;optional params&gt; ) - bulk execute write operations, optional parameters are: w, wtimeout, j
   db.f.count( query = &#123;&#125;, &lt;optional params&gt; ) - count the number of documents that matches the query, optional parameters are: limit, skip, hint, maxTimeMS
   db.f.countDocuments( query = &#123;&#125;, &lt;optional params&gt; ) - count the number of documents that matches the query, optional parameters are: limit, skip, hint, maxTimeMS
   db.f.estimatedDocumentCount( &lt;optional params&gt; ) - estimate the document count using collection metadata, optional parameters are: maxTimeMS
   ...</code></pre>
</li>
<li><p>show dbs 展示server上的所有db</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> show dbs</span>
admin   0.000GB
config  0.000GB
files   0.013GB
local   0.000GB
test    0.000GB</code></pre>
</li>
<li><p>use &lt;db&gt; 切换当前db</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> db</span>
files
<span class="hljs-meta">&gt;</span><span class="bash"> use <span class="hljs-built_in">test</span></span>
switched to db test
<span class="hljs-meta">&gt;</span><span class="bash"> db</span>
test</code></pre>
</li>
<li><p>show collections 展示当前db下的所有集合</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> show collections</span>
files
files.chunks
files.files</code></pre>
</li>
<li><p>show users 展示当前库的用户</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> show dbs</span>
admin   0.000GB
config  0.000GB
files   0.013GB
local   0.000GB
test    0.000GB
<span class="hljs-meta">&gt;</span><span class="bash"> use admin</span>
switched to db admin
<span class="hljs-meta">&gt;</span><span class="bash"> show users</span>
&#123;
   &quot;_id&quot; : &quot;admin.root&quot;,
   &quot;userId&quot; : UUID(&quot;1198568b-e718-4c8c-b91b-e551de9d819c&quot;),
   &quot;user&quot; : &quot;root&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;roles&quot; : [
           &#123;
                   &quot;role&quot; : &quot;root&quot;,
                   &quot;db&quot; : &quot;admin&quot;
           &#125;
   ],
   &quot;mechanisms&quot; : [
           &quot;SCRAM-SHA-1&quot;,
           &quot;SCRAM-SHA-256&quot;
   ]
&#125;</code></pre>
</li>
<li><p>show  roles 展示当前库的所有角色包括内置和自定义的</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> show roles</span>
&#123;
   &quot;role&quot; : &quot;__queryableBackup&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;__system&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;backup&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;clusterAdmin&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;clusterManager&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;clusterMonitor&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;dbAdmin&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;dbAdminAnyDatabase&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;dbOwner&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;enableSharding&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;hostManager&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;read&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;readAnyDatabase&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;readWrite&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;readWriteAnyDatabase&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;restore&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;root&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;userAdmin&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;
&#123;
   &quot;role&quot; : &quot;userAdminAnyDatabase&quot;,
   &quot;db&quot; : &quot;admin&quot;,
   &quot;isBuiltin&quot; : true,
   &quot;roles&quot; : [ ],
   &quot;inheritedRoles&quot; : [ ]
&#125;</code></pre>



</li>
</ul>
</li>
</ol>
<ul>
<li>show profile 打印5个耗时大于1毫秒的最新的更新操作</li>
<li>show databases 打印可用数据库</li>
<li>load() 加载脚本文件</li>
</ul>
<ol start="4">
<li><p>JavaScript 常用方法</p>
<blockquote>
<p>db 参数是当前数据库，默认是test，可以用use命令切换当前库</p>
</blockquote>
<ul>
<li>db.auth() 安全模式下 验证用户</li>
<li>coll = db.&lt;collection&gt;  获取集合</li>
<li>db.collection.find() 查询当前集合的所有文档</li>
<li>db.collection.insertOne() 当前集合插入一条记录</li>
<li>db.collection.updateOne() 当前集合更新一条记录</li>
<li>db.collection.updateMany() 当前集合批量更新</li>
<li>db.collection.save() 当前集合插入新记录或更新已存在的记录</li>
<li>db.collection.deleteOne() 当前集合删除一条记录</li>
<li>db.collection.deleteMany() 当前集合删除多条记录</li>
<li>db.collection.drop() 删除当前集合</li>
<li>db.collection.createIndex() 给当前集合建索引，如果索引已经存在了，则操作无效</li>
<li>db.getSiblingDB() 用当前连接去连接另一个db</li>
</ul>
</li>
<li><p>查询</p>
<ul>
<li><p>db.collection.find(&lt;query&gt;)<br>查询与&lt;query&gt;参数相匹配的数据，如果&lt;query&gt;为空，则返回全部数据。类比SQL中 where子句。</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find()</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089c1bdfef17fa641366e&quot;), &quot;name&quot; : &quot;zhangsan&quot;, &quot;age&quot; : 15 &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089cebdfef17fa641366f&quot;), &quot;name&quot; : &quot;lisi&quot;, &quot;age&quot; : 16 &#125;
<span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find(&#123;name:<span class="hljs-string">&#x27;lisi&#x27;</span>&#125;)</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089cebdfef17fa641366f&quot;), &quot;name&quot; : &quot;lisi&quot;, &quot;age&quot; : 16 &#125;</code></pre>
</li>
<li><p>db.collection.find(&lt;query&gt;,&lt;projection&gt;)</p>
<p>&lt;projection&gt;返回字段，类比SQL中的SELECT子句。</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find(&#123;name:<span class="hljs-string">&#x27;lisi&#x27;</span>&#125;,&#123;name:<span class="hljs-literal">true</span>&#125;)</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089cebdfef17fa641366f&quot;), &quot;name&quot; : &quot;lisi&quot; &#125;
<span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find(&#123;name:<span class="hljs-string">&#x27;lisi&#x27;</span>&#125;,&#123;age:<span class="hljs-literal">true</span>&#125;)</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089cebdfef17fa641366f&quot;), &quot;age&quot; : 16 &#125;
<span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find(&#123;name:<span class="hljs-string">&#x27;lisi&#x27;</span>&#125;,&#123;age:<span class="hljs-literal">true</span>,name:<span class="hljs-literal">true</span>&#125;)</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089cebdfef17fa641366f&quot;), &quot;name&quot; : &quot;lisi&quot;, &quot;age&quot; : 16 &#125;</code></pre>
</li>
<li><p>db.collection.find().sort(&lt;sort order&gt;)<br>结果集排序，sort按照什么字段排序，order取值 1和-1，1正序，-1倒序。</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find().sort(&#123;age:1&#125;)</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089c1bdfef17fa641366e&quot;), &quot;name&quot; : &quot;zhangsan&quot;, &quot;age&quot; : 15 &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089cebdfef17fa641366f&quot;), &quot;name&quot; : &quot;lisi&quot;, &quot;age&quot; : 16 &#125;
<span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find().sort(&#123;age:-1&#125;)</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089cebdfef17fa641366f&quot;), &quot;name&quot; : &quot;lisi&quot;, &quot;age&quot; : 16 &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089c1bdfef17fa641366e&quot;), &quot;name&quot; : &quot;zhangsan&quot;, &quot;age&quot; : 15 &#125;</code></pre>
</li>
<li><p>db.collection.find().limit(&lt;n&gt;) 限制返回结果集的条数</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find().<span class="hljs-built_in">limit</span>(1)</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089c1bdfef17fa641366e&quot;), &quot;name&quot; : &quot;zhangsan&quot;, &quot;age&quot; : 15 &#125;
<span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find().<span class="hljs-built_in">limit</span>(2)</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089c1bdfef17fa641366e&quot;), &quot;name&quot; : &quot;zhangsan&quot;, &quot;age&quot; : 15 &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089cebdfef17fa641366f&quot;), &quot;name&quot; : &quot;lisi&quot;, &quot;age&quot; : 16 &#125;</code></pre>
</li>
<li><p>db.collection.find().skip(&lt;n&gt;) 跳过几条</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find()</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089c1bdfef17fa641366e&quot;), &quot;name&quot; : &quot;zhangsan&quot;, &quot;age&quot; : 15 &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089cebdfef17fa641366f&quot;), &quot;name&quot; : &quot;lisi&quot;, &quot;age&quot; : 16 &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;5f608d3bbdfef17fa6413670&quot;), &quot;name&quot; : &quot;wangwu&quot;, &quot;age&quot; : 17 &#125;
<span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find().skip(1)</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089cebdfef17fa641366f&quot;), &quot;name&quot; : &quot;lisi&quot;, &quot;age&quot; : 16 &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;5f608d3bbdfef17fa6413670&quot;), &quot;name&quot; : &quot;wangwu&quot;, &quot;age&quot; : 17 &#125;
<span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find().skip(2)</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f608d3bbdfef17fa6413670&quot;), &quot;name&quot; : &quot;wangwu&quot;, &quot;age&quot; : 17 &#125;</code></pre>



</li>
</ul>
</li>
</ol>
<ul>
<li><p>db.collection.find().count() 返回记录数</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find()</span>
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089c1bdfef17fa641366e&quot;), &quot;name&quot; : &quot;zhangsan&quot;, &quot;age&quot; : 15 &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;5f6089cebdfef17fa641366f&quot;), &quot;name&quot; : &quot;lisi&quot;, &quot;age&quot; : 16 &#125;
&#123; &quot;_id&quot; : ObjectId(&quot;5f608d3bbdfef17fa6413670&quot;), &quot;name&quot; : &quot;wangwu&quot;, &quot;age&quot; : 17 &#125;
<span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find().count()</span>
3
<span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.find(&#123;name:<span class="hljs-string">&#x27;zhangsan&#x27;</span>&#125;).count()</span>
1</code></pre>



</li>
</ul>
<ul>
<li><p>db.collection.findOne(&lt;query&gt;) 返回单独一条 不传&lt;query&gt;则返回第一条</p>
<pre><code class="hljs reasonml">&gt; db.coll1.find<span class="hljs-literal">()</span>
&#123; <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-constructor">ObjectId(<span class="hljs-string">&quot;5f6089c1bdfef17fa641366e&quot;</span>)</span>, <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;zhangsan&quot;</span>, <span class="hljs-string">&quot;age&quot;</span> : <span class="hljs-number">15</span> &#125;
&#123; <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-constructor">ObjectId(<span class="hljs-string">&quot;5f6089cebdfef17fa641366f&quot;</span>)</span>, <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;lisi&quot;</span>, <span class="hljs-string">&quot;age&quot;</span> : <span class="hljs-number">16</span> &#125;
&#123; <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-constructor">ObjectId(<span class="hljs-string">&quot;5f608d3bbdfef17fa6413670&quot;</span>)</span>, <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;wangwu&quot;</span>, <span class="hljs-string">&quot;age&quot;</span> : <span class="hljs-number">17</span> &#125;
&gt; db.coll1.find<span class="hljs-constructor">One()</span>
&#123;
   <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-constructor">ObjectId(<span class="hljs-string">&quot;5f6089c1bdfef17fa641366e&quot;</span>)</span>,
   <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;zhangsan&quot;</span>,
   <span class="hljs-string">&quot;age&quot;</span> : <span class="hljs-number">15</span>
&#125;
&gt; db.coll1.find<span class="hljs-constructor">One(&#123;<span class="hljs-params">name</span>:&#x27;<span class="hljs-params">lisi</span>&#x27;&#125;)</span>
&#123;
   <span class="hljs-string">&quot;_id&quot;</span> : <span class="hljs-constructor">ObjectId(<span class="hljs-string">&quot;5f6089cebdfef17fa641366f&quot;</span>)</span>,
   <span class="hljs-string">&quot;name&quot;</span> : <span class="hljs-string">&quot;lisi&quot;</span>,
   <span class="hljs-string">&quot;age&quot;</span> : <span class="hljs-number">16</span>
&#125;</code></pre>



</li>
</ul>
<ul>
<li><p>db.fromCollection.renameCollection(&lt;toCollectionName&gt;) 修改集合名</p>
<pre><code class="hljs shell"><span class="hljs-meta">&gt;</span><span class="bash"> show collections</span>
coll1
collection
<span class="hljs-meta">&gt;</span><span class="bash"> db.coll</span>
db.coll1       db.collection
<span class="hljs-meta">&gt;</span><span class="bash"> db.coll1.renameCollection(<span class="hljs-string">&#x27;coll2&#x27;</span>)</span>
&#123; &quot;ok&quot; : 1 &#125;
<span class="hljs-meta">&gt;</span><span class="bash"> show collections</span>
coll2
collection</code></pre>

</li>
</ul>

            </div>
            <hr>
            <div>
              <div class="post-metas mb-3">
                
                  <div class="post-meta mr-3">
                    <i class="iconfont icon-category"></i>
                    
                      <a class="hover-with-bg" href="/categories/DB/">DB</a>
                    
                  </div>
                
                
                  <div class="post-meta">
                    <i class="iconfont icon-tags"></i>
                    
                      <a class="hover-with-bg" href="/tags/DB/">DB</a>
                    
                      <a class="hover-with-bg" href="/tags/MongoDB/">MongoDB</a>
                    
                  </div>
                
              </div>
              
                <p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p>
              
              
                <div class="post-prevnext row">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2020/09/18/leetcode/LeetCode1/">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">LeetCode(一)</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2020/09/02/linux/ag/ag/">
                        <span class="hidden-mobile">ag-命令行查找工具</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>
    
      <div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn">
        <div id="toc">
  <p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p>
  <div id="tocbot"></div>
</div>

      </div>
    
  </div>
</div>

<!-- Custom -->


    
  </main>

  
    <a id="scroll-top-button" href="#" role="button">
      <i class="iconfont icon-arrowup" aria-hidden="true"></i>
    </a>
  

  
    <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v"
                 for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>
  

  

  

  <footer class="mt-5">
  <div class="text-center py-3">
    <div>
      <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a>
      <i class="iconfont icon-love"></i>
      <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener">
        <span>Fluid</span></a>
    </div>
    

    

    
  </div>
</footer>

<!-- SCRIPTS -->
<script  src="https://cdn.staticfile.org/jquery/3.4.1/jquery.min.js" ></script>
<script  src="https://cdn.staticfile.org/twitter-bootstrap/4.4.1/js/bootstrap.min.js" ></script>
<script  src="/js/debouncer.js" ></script>
<script  src="/js/main.js" ></script>

<!-- Plugins -->


  
    <script  src="/js/lazyload.js" ></script>
  



  <script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js" ></script>
  <script  src="/js/clipboard-use.js" ></script>







  <script  src="https://cdn.staticfile.org/tocbot/4.11.1/tocbot.min.js" ></script>
  <script>
    $(document).ready(function () {
      var boardCtn = $('#board-ctn');
      var boardTop = boardCtn.offset().top;

      tocbot.init({
        tocSelector: '#tocbot',
        contentSelector: '#post-body',
        headingSelector: 'h1,h2,h3,h4,h5,h6',
        linkClass: 'tocbot-link',
        activeLinkClass: 'tocbot-active-link',
        listClass: 'tocbot-list',
        isCollapsedClass: 'tocbot-is-collapsed',
        collapsibleClass: 'tocbot-is-collapsible',
        collapseDepth: 0,
        scrollSmooth: true,
        headingsOffset: -boardTop
      });
      if ($('.toc-list-item').length > 0) {
        $('#toc').css('visibility', 'visible');
      }
    });
  </script>



  <script  src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js" ></script>
  <script>
    var typed = new Typed('#subtitle', {
      strings: [
        '  ',
        "MongoDB(一)&nbsp;",
      ],
      cursorChar: "_",
      typeSpeed: 70,
      loop: false,
    });
    typed.stop();
    $(document).ready(function () {
      $(".typed-cursor").addClass("h2");
      typed.start();
    });
  </script>



  <script  src="https://cdn.staticfile.org/anchor-js/4.2.2/anchor.min.js" ></script>
  <script>
    anchors.options = {
      placement: "right",
      visible: "hover",
      
    };
    var el = "h1,h2,h3,h4,h5,h6".split(",");
    var res = [];
    for (item of el) {
      res.push(".markdown-body > " + item)
    }
    anchors.add(res.join(", "))
  </script>



  <script  src="/js/local-search.js" ></script>
  <script>
    var path = "/local-search.xml";
    var inputArea = document.querySelector("#local-search-input");
    inputArea.onclick = function () {
      searchFunc(path, 'local-search-input', 'local-search-result');
      this.onclick = null
    }
  </script>



  <script  src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js" ></script>
  <link  rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css" />

  <script>
    $('#post img:not(.no-zoom img, img[no-zoom]), img[zoom]').each(
      function () {
        var element = document.createElement('a');
        $(element).attr('data-fancybox', 'images');
        $(element).attr('href', $(this).attr('src'));
        $(this).wrap(element);
      }
    );
  </script>




















</body>
</html>
